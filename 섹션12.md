## 경로 표현식

- .(점)을 찍어 객체 그래프를 탐색하는 것

```
select **m.username**  // 상태 필드
from Member m
join **m.team** t  // 단일 값 연관 필드
join **m.orders** o  // 컬렉션 값 연관 필드
where t.name = '팀A'
```

### 경로 표현식 용어 정리

- 상태 필드(state field)
    - 단순히 값을 저장하기 위한 필드(ex. m.username)
- 연관 필드(association field)
    - 연관관계를 위한 필드
    1. 단일 값 연관 필드
        - `@ManyToOne`, `@OneToOne`, 대상이 엔티티(ex. m.team)
    2. 컬렉션 값 연관 필드
        - `@OneToMany`, `@ManyToMany`, 대상이 컬렉션(ex. m.orders)

### 경로 표현식 특징

> 상태 필드(state field)
<br> - 경로 탐색의 끝, 탐색 X

```
select m.username From Member m
```

> 단일 값 연관 경로
<br> - 묵시적 내부 조인(inner join) 발생, 탐색 O

- 묵시적 내부 조인 ⭐

    ```
    // 쿼리문
    select m.team From Member m
    
    // 출력결과
    Hibernate: 
        /* select
            m.team 
        From
            Member m */ select
                t1_0.id,
                t1_0.name 
            from
                Member m1_0 
            join
                Team t1_0 
                    on t1_0.id=m1_0.TEAM_ID
    ```

    - select문으로 작성했지만 내부 조인 발생
- 계속 탐색할 수 있다. (team 내의 필드 조회)

    ```
    select m.team.name From Member m
    ```


> 컬렉션 값 연관 경로
<br> - 묵시적 내부 조인 발생, 탐색X

```
select t.members From Team t
```

- 컬렉션 자체를 가리키기 때문에 필드를 찍는 등 더이상 탐색은 할 수 없음!
  (members 내의 username 탐색 불가)

```
select m.username From Team t join t.members m
```

- From절에서 명시적 조인을 통해 별칭을 얻으면 별칭을 통해 탐색 가능

  (명시적 조인을 써야 쿼리 튜닝 등 유지보수 측면에서 좋음)


### 상태 필드 경로 탐색

- JPQL

    ```
    select m.username, m.age from Member m
    ```

- SQL

    ```
    select m.username, m.age from Member m
    ```


### 단일 값 연관 경로 탐색

- JPQL

    ```
    select o.member from Order o
    ```

- SQL

    ```
    select m.* from Order o inner join Member m on o.member_id = m.id
    ```


### 명시적 조인, 묵시적 조인

- 명시적 조인

    ```
    select m from Member m join m.team t
    ```

    - join 키워드 직접 사용
- 묵시적 조인

    ```
    select m.team from Member m
    ```

    - 경로 표현식에 의해 묵시적으로 SQL 조인 발생
      (내부 조인만 가능)

### 경로 탐색을 사용한 묵시적 조인 시 주의사항

- 항상 내부 조인
- 컬렉션은 경로 탐색의 끝, 명시적 조인을 통해 별칭을 얻어야 함
- 경로 탐색은 주로 SELECT, WHERE절에서 사용하지만 묵시적 조인으로 인해 SQL의 FROM (JOIN) 절에 영향을 줌
- **가급적 묵시적 조인 대신 명시적 조인 사용**
- 조인은 SQL 튜닝에 중요 포인트
- 묵시적 조인은 조인이 일어나는 상황을 한눈에 파악하기 어려움