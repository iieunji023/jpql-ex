## ê²½ë¡œ í‘œí˜„ì‹

- .(ì )ì„ ì°ì–´ ê°ì²´ ê·¸ë˜í”„ë¥¼ íƒìƒ‰í•˜ëŠ” ê²ƒ

```
select **m.username**  // ìƒíƒœ í•„ë“œ
from Member m
join **m.team** t  // ë‹¨ì¼ ê°’ ì—°ê´€ í•„ë“œ
join **m.orders** o  // ì»¬ë ‰ì…˜ ê°’ ì—°ê´€ í•„ë“œ
where t.name = 'íŒ€A'
```

### ê²½ë¡œ í‘œí˜„ì‹ ìš©ì–´ ì •ë¦¬

- ìƒíƒœ í•„ë“œ(state field)
    - ë‹¨ìˆœíˆ ê°’ì„ ì €ì¥í•˜ê¸° ìœ„í•œ í•„ë“œ(ex. m.username)
- ì—°ê´€ í•„ë“œ(association field)
    - ì—°ê´€ê´€ê³„ë¥¼ ìœ„í•œ í•„ë“œ
    1. ë‹¨ì¼ ê°’ ì—°ê´€ í•„ë“œ
        - `@ManyToOne`, `@OneToOne`, ëŒ€ìƒì´ ì—”í‹°í‹°(ex. m.team)
    2. ì»¬ë ‰ì…˜ ê°’ ì—°ê´€ í•„ë“œ
        - `@OneToMany`, `@ManyToMany`, ëŒ€ìƒì´ ì»¬ë ‰ì…˜(ex. m.orders)

### ê²½ë¡œ í‘œí˜„ì‹ íŠ¹ì§•

> ìƒíƒœ í•„ë“œ(state field)
<br> - ê²½ë¡œ íƒìƒ‰ì˜ ë, íƒìƒ‰ X

```
select m.username From Member m
```

> ë‹¨ì¼ ê°’ ì—°ê´€ ê²½ë¡œ
<br> - ë¬µì‹œì  ë‚´ë¶€ ì¡°ì¸(inner join) ë°œìƒ, íƒìƒ‰ O

- ë¬µì‹œì  ë‚´ë¶€ ì¡°ì¸ â­

    ```
    // ì¿¼ë¦¬ë¬¸
    select m.team From Member m
    
    // ì¶œë ¥ê²°ê³¼
    Hibernate: 
        /* select
            m.team 
        From
            Member m */ select
                t1_0.id,
                t1_0.name 
            from
                Member m1_0 
            join
                Team t1_0 
                    on t1_0.id=m1_0.TEAM_ID
    ```

    - selectë¬¸ìœ¼ë¡œ ì‘ì„±í–ˆì§€ë§Œ ë‚´ë¶€ ì¡°ì¸ ë°œìƒ
- ê³„ì† íƒìƒ‰í•  ìˆ˜ ìˆë‹¤. (team ë‚´ì˜ í•„ë“œ ì¡°íšŒ)

    ```
    select m.team.name From Member m
    ```


> ì»¬ë ‰ì…˜ ê°’ ì—°ê´€ ê²½ë¡œ
<br> - ë¬µì‹œì  ë‚´ë¶€ ì¡°ì¸ ë°œìƒ, íƒìƒ‰X

```
select t.members From Team t
```

- ì»¬ë ‰ì…˜ ìì²´ë¥¼ ê°€ë¦¬í‚¤ê¸° ë•Œë¬¸ì— í•„ë“œë¥¼ ì°ëŠ” ë“± ë”ì´ìƒ íƒìƒ‰ì€ í•  ìˆ˜ ì—†ìŒ!
  (members ë‚´ì˜ username íƒìƒ‰ ë¶ˆê°€)

```
select m.username From Team t join t.members m
```

- Fromì ˆì—ì„œ ëª…ì‹œì  ì¡°ì¸ì„ í†µí•´ ë³„ì¹­ì„ ì–»ìœ¼ë©´ ë³„ì¹­ì„ í†µí•´ íƒìƒ‰ ê°€ëŠ¥

  (ëª…ì‹œì  ì¡°ì¸ì„ ì¨ì•¼ ì¿¼ë¦¬ íŠœë‹ ë“± ìœ ì§€ë³´ìˆ˜ ì¸¡ë©´ì—ì„œ ì¢‹ìŒ)


### ìƒíƒœ í•„ë“œ ê²½ë¡œ íƒìƒ‰

- JPQL

    ```
    select m.username, m.age from Member m
    ```

- SQL

    ```
    select m.username, m.age from Member m
    ```


### ë‹¨ì¼ ê°’ ì—°ê´€ ê²½ë¡œ íƒìƒ‰

- JPQL

    ```
    select o.member from Order o
    ```

- SQL

    ```
    select m.* from Order o inner join Member m on o.member_id = m.id
    ```


### ëª…ì‹œì  ì¡°ì¸, ë¬µì‹œì  ì¡°ì¸

- ëª…ì‹œì  ì¡°ì¸

    ```
    select m from Member m join m.team t
    ```

    - join í‚¤ì›Œë“œ ì§ì ‘ ì‚¬ìš©
- ë¬µì‹œì  ì¡°ì¸

    ```
    select m.team from Member m
    ```

    - ê²½ë¡œ í‘œí˜„ì‹ì— ì˜í•´ ë¬µì‹œì ìœ¼ë¡œ SQL ì¡°ì¸ ë°œìƒ
      (ë‚´ë¶€ ì¡°ì¸ë§Œ ê°€ëŠ¥)

### ê²½ë¡œ íƒìƒ‰ì„ ì‚¬ìš©í•œ ë¬µì‹œì  ì¡°ì¸ ì‹œ ì£¼ì˜ì‚¬í•­

- í•­ìƒ ë‚´ë¶€ ì¡°ì¸
- ì»¬ë ‰ì…˜ì€ ê²½ë¡œ íƒìƒ‰ì˜ ë, ëª…ì‹œì  ì¡°ì¸ì„ í†µí•´ ë³„ì¹­ì„ ì–»ì–´ì•¼ í•¨
- ê²½ë¡œ íƒìƒ‰ì€ ì£¼ë¡œ SELECT, WHEREì ˆì—ì„œ ì‚¬ìš©í•˜ì§€ë§Œ ë¬µì‹œì  ì¡°ì¸ìœ¼ë¡œ ì¸í•´ SQLì˜ FROM (JOIN) ì ˆì— ì˜í–¥ì„ ì¤Œ
- **ê°€ê¸‰ì  ë¬µì‹œì  ì¡°ì¸ ëŒ€ì‹  ëª…ì‹œì  ì¡°ì¸ ì‚¬ìš©**
- ì¡°ì¸ì€ SQL íŠœë‹ì— ì¤‘ìš” í¬ì¸íŠ¸
- ë¬µì‹œì  ì¡°ì¸ì€ ì¡°ì¸ì´ ì¼ì–´ë‚˜ëŠ” ìƒí™©ì„ í•œëˆˆì— íŒŒì•…í•˜ê¸° ì–´ë ¤ì›€

<br>

## í˜ì¹˜ ì¡°ì¸ 1 - ê¸°ë³¸

ì¡°íšŒí•  ë•Œ ë§ì´ ì‚¬ìš©

ì‹¤ë¬´ì—ì„œ ì¤‘ìš”!!

- SQL ì¡°ì¸ ì¢…ë¥˜ X
- JPQLì—ì„œ **ì„±ëŠ¥ ìµœì í™”**ë¥¼ ìœ„í•´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥
- ì—°ê´€ëœ ì—”í‹°í‹°ë‚˜ ì»¬ë ‰ì…˜ì„ **SQL í•œë²ˆì— í•¨ê»˜ ì¡°íšŒ**í•˜ëŠ” ê¸°ëŠ¥
- join fetch ëª…ë ¹ì–´ ì‚¬ìš©
- í˜ì¹˜ ì¡°ì¸ ::=[LEFT [OUTER] | INNER ] JOIN FETCH ì¡°ì¸ê²½ë¡œ

### ì—”í‹°í‹° í˜ì¹˜ ì¡°ì¸

- íšŒì›ì„ ì¡°íšŒí•˜ë©´ì„œ ì—°ê´€ëœ íŒ€ë„ í•¨ê»˜ ì¡°íšŒ(SQL í•œë²ˆì—)
- SQLì„ ë³´ë©´ íšŒì› ë¿ë§Œ ì•„ë‹ˆë¼ **íŒ€(T.*)**ë„ í•¨ê»˜ **SELECT**
- [JPQL]
  select m from Member m **join fetch** m.team
- [SQL]
  SELECT M.*, **T.*** FROM MEMBER M **INNER JOIN TEAM** T ON M.TEAM_ID=T.ID
- **ì¦‰ì‹œë¡œë”©**ìœ¼ë¡œ ê°€ì ¸ì˜¬ ë•Œì™€ ë™ì¼

<img src="https://github.com/iieunji023/jpql-ex/blob/main/images/í˜ì¹˜ì¡°ì¸1.png" width="450"><br>
<img src="https://github.com/iieunji023/jpql-ex/blob/main/images/í˜ì¹˜ì¡°ì¸2.png" width="300">

### ì‹¤ìŠµ

ğŸ”§ Member ì¡°íšŒ(í˜ì¹˜ì¡°ì¸ ì‚¬ìš© X)

<details>
      <summary>main.java</summary>

```
Team teamA = new Team();
teamA.setName("íŒ€A");
em.persist(teamA);

Team teamB = new Team();
teamB.setName("íŒ€B");
em.persist(teamB);

Member member1 = new Member();
member1.setUsername("íšŒì›1");
member1.setTeam(teamA);
em.persist(member1);

Member member2 = new Member();
member2.setUsername("íšŒì›2");
member2.setTeam(teamA);
em.persist(member2);

Member member3 = new Member();
member3.setUsername("íšŒì›3");
member3.setTeam(teamB);
em.persist(member3);

em.flush();
em.clear();

String query = "select m From Member m";
List<Member> result = em.createQuery(query, Member.class).getResultList();

for (Member member : result) {
     System.out.println("member= " + member.getUsername() + ", " + member.getTeam().getName());
     // íšŒì›1, íŒ€A(SQL)
     // íšŒì›2, íŒ€A(1ì°¨ìºì‹œ)
     // íšŒì›3, íŒ€B
}
            
tx.commit();
```

</details>
<details>
      <summary>ì¿¼ë¦¬ ì¡°íšŒ ê²°ê³¼</summary>

```
    /* select
        m 
    From
        Member m 
    join
        
    fetch
        m.team */ select
            m1_0.id,
            m1_0.age,
            t1_0.id,
            t1_0.name,
            m1_0.type,
            m1_0.username 
        from
            Member m1_0 
        join
            Team t1_0 
                on t1_0.id=m1_0.TEAM_ID
member= íšŒì›1, íŒ€A
member= íšŒì›2, íŒ€A
member= íšŒì›3, íŒ€B
```

- í˜ì¹˜ì¡°ì¸ìœ¼ë¡œ íšŒì›ê³¼ íŒ€ì„ í•¨ê»˜ ì¡°íšŒí•´ì„œ ì§€ì—°ë¡œë”©X
- JOINí•  ë•Œ memberì™€ team í…Œì´ë¸” ë‚´ì˜ ì»¬ëŸ¼ì„ ëª¨ë‘ ì¡°íšŒí•˜ë¯€ë¡œ selectë¬¸ í•œë²ˆë§Œ ë‚ ë¼ê°
- ì§€ì—°ë¡œë”©ìœ¼ë¡œ ì„¸íŒ…í•´ë„ í˜ì¹˜ì¡°ì¸ì´ í•­ìƒ ìš°ì„ 

</details>

ğŸ’¡ ì¼ëŒ€ë‹¤ ê´€ê³„ì—ì„œ, ì»¬ë ‰ì…˜ í˜ì¹˜ ì¡°ì¸ì„ ì‹¤í–‰í•´ë³´ì

- **[JPQL]** <br>
  select t from Team t join fetch t.members
  where t.name = â€˜íŒ€Aâ€™
- **[SQL]** <br>
  SELECT T.*, M.* FROM TEAMT
  INNER JOIN MEMBER M ON T.ID=M.TEAM_ID
  WHERE T.NAME=â€™íŒ€Aâ€™

<img src="https://github.com/iieunji023/jpql-ex/blob/main/images/í˜ì¹˜ì¡°ì¸3.png" width="500">

ğŸ”§ ì»¬ë ‰ì…˜ í˜ì¹˜ ì¡°ì¸ ì½”ë“œ
```
String query = "select t From Team t join fetch t.members";
List<Team> result = em.createQuery(query, Team.class).getResultList();

for (Team team : result) {
     System.out.println("team= " + team.getName() + " |members= " + team.getMembers().size());
     for(Member member : team.getMembers()) {
          System.out.println("-> member = " + member);
     }
}
```
ğŸ”— ì¶œë ¥ê²°ê³¼
```
team= íŒ€A |members= 2
-> member = Member{id=1, username='íšŒì›1', age=0}
-> member = Member{id=2, username='íšŒì›2', age=0}
team= íŒ€B |members= 1
-> member = Member{id=3, username='íšŒì›3', age=0}
```
- ì¼ëŒ€ë‹¤ ì»¬ë ‰ì…˜ í˜ì¹˜ ì¡°ì¸ì„ í•˜ë©´ íŒ€AëŠ” í•˜ë‚˜ì§€ë§Œ, íŒ€Aì— ì†Œì†ëœ íšŒì›ì´ 2ëª…ì´ë¯€ë¡œ sizeê°€ ì¦ê°€í•œë‹¤.

### í˜ì¹˜ ì¡°ì¸ê³¼ ì¼ë°˜ ì¡°ì¸ì˜ ì°¨ì´

- ì¼ë°˜ ì¡°ì¸ ì‹¤í–‰ì‹œ ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ í•¨ê»˜ ì¡°íšŒí•˜ì§€ ì•ŠìŒ
```
select t From Team t join t.members m
```

ğŸ”— ì¶œë ¥ê²°ê³¼
```
Hibernate: 
    select
        m1_0.TEAM_ID,
        m1_0.id,
        m1_0.age,
        m1_0.type,
        m1_0.username 
    from
        Member m1_0 
    where
        m1_0.TEAM_ID=?
team= íŒ€A |members= 2
-> member = Member{id=1, username='íšŒì›1', age=0}
-> member = Member{id=2, username='íšŒì›2', age=0}
Hibernate: 
    select
        m1_0.TEAM_ID,
        m1_0.id,
        m1_0.age,
        m1_0.type,
        m1_0.username 
    from
        Member m1_0 
    where
        m1_0.TEAM_ID=?
team= íŒ€B |members= 1
-> member = Member{id=3, username='íšŒì›3', age=0}
```
- ì¼ë°˜ ì¡°ì¸ì„ í•˜ë©´, ê° í…Œì´ë¸”ì— ëŒ€í•œ selectë¬¸ì´ ë³„ë„ë¡œ ìƒì„±ëœë‹¤.

```
Hibernate: 
    /* select
        t 
    From
        Team t 
    join
        
    fetch
        t.members */ select
            t1_0.id,
            m1_0.TEAM_ID,
            m1_0.id,
            m1_0.age,
            m1_0.type,
            m1_0.username,
            t1_0.name 
        from
            Team t1_0 
        join
            Member m1_0 
                on t1_0.id=m1_0.TEAM_ID
team= íŒ€A |members= 2
-> member = Member{id=1, username='íšŒì›1', age=0}
-> member = Member{id=2, username='íšŒì›2', age=0}
team= íŒ€B |members= 1
-> member = Member{id=3, username='íšŒì›3', age=0}
```
- í˜ì¹˜ ì¡°ì¸ì„ í•˜ê²Œ ë˜ë©´ í•˜ë‚˜ì˜ selectë¬¸ì— member, team í…Œì´ë¸”ì˜ ì»¬ëŸ¼ì„ ëª¨ë‘ ì¡°íšŒí•œë‹¤.

ë”°ë¼ì„œ, í˜ì¹˜ ì¡°ì¸ê³¼ ì¼ë°˜ ì¡°ì¸ì˜ ì°¨ì´ëŠ”

- JPQLì€ ê²°ê³¼ë¥¼ ë°˜í™˜í•  ë•Œ ì—°ê´€ê´€ê³„ ê³ ë ¤X
- ë‹¨ì§€ SELECTì ˆì— ì§€ì •í•œ ì—”í‹°í‹°ë§Œ ì¡°íšŒí•  ë¿
- ì—¬ê¸°ì„œëŠ” íŒ€ ì—”í‹°í‹°ë§Œ ì¡°íšŒí•˜ê³ , íšŒì› ì—”í‹°í‹°ëŠ” ì¡°íšŒX
- í˜ì¹˜ ì¡°ì¸ì„ ì‚¬ìš©í•  ë•Œë§Œ ì—°ê´€ëœ ì—”í‹°í‹°ë„ í•¨ê»˜ **ì¡°íšŒ(ì¦‰ì‹œ ë¡œë”©)**
- **í˜ì¹˜ ì¡°ì¸ì€ ê°ì²´ ê·¸ë˜í”„ë¥¼ SQL í•œë²ˆì— ì¡°íšŒí•˜ëŠ” ê°œë…**